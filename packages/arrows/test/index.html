<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8' />
    <title>Annotorious | Arrows Plugin</title>
  </head>

  <body>
    <div id="content">
      <div>
        <button id="tool">Annotate</button>
        <button id="arrow-mode" disabled>Select</button>
        <button id="arrow-visibility">Show Always</button>
      </div>
      <img id="sample-image" src="640px-Hallstatt.jpg" />
    </div>
    
    <script type="module">
      import { createImageAnnotator } from '@annotorious/annotorious';
      import { createStoreSynchronizer } from '@annotorious/plugin-broadcast-channel-sync';
      import { mountImagePlugin } from '../src';

      import '@annotorious/annotorious/annotorious.css';

      window.onload = function() {    
        const anno = createImageAnnotator('sample-image');
        const arrowsPlugin = mountImagePlugin(anno);

        const sync = createStoreSynchronizer(anno.state.store, {
          channelName: 'my-app-annotations',
          debug: false // Enable logging during development
        });

        sync.connect();

        anno.loadAnnotations('annotations.json');

        const arrowModeBtn = document.getElementById('arrow-mode');
        arrowModeBtn.addEventListener('click', () => {
          if (arrowModeBtn.innerText === 'Draw') {
            arrowModeBtn.innerText = 'Select';
            arrowsPlugin.setMode('select');
          } else {
            arrowModeBtn.innerText = 'Draw';
            arrowsPlugin.setMode('draw');
          }
        });

        anno.on('createAnnotation', a => {
          console.log('created', a);
          
          if (a.motivation === 'pointing') {
            arrowsPlugin.setMode('select');
            arrowModeBtn.innerText = 'Select';
          }
        });

        anno.on('updateAnnotation', a => console.log('updated', a));
        anno.on('selectionChanged', s => console.log('selected', s));

        const toolBtn = document.getElementById('tool');
        toolBtn.addEventListener('click', () => {
          if (toolBtn.innerText === 'Annotate') {
            toolBtn.innerText = 'Arrows';
            arrowModeBtn.disabled = false;
          } else {
            toolBtn.innerText = 'Annotate';
            arrowModeBtn.disabled = true;
          }
        });

        const visibilityBtn = document.getElementById('arrow-visibility');
        visibilityBtn.addEventListener('click', () => {
          if (visibilityBtn.innerText === 'Show Always') {
            visibilityBtn.innerText = 'Hover Only';
            arrowsPlugin.setVisibility('HOVER_ONLY');
          } else if (visibilityBtn.innerText === 'Hover Only') {
            visibilityBtn.innerText = 'Selected Only';
            arrowsPlugin.setVisibility('SELECTED_ONLY');
          } else  if (visibilityBtn.innerText === 'Selected Only') {
            visibilityBtn.innerText = 'Hover/Select';
            arrowsPlugin.setVisibility('HOVER_OR_SELECT');
          } else if (visibilityBtn.innerText === 'Hover/Select') {
            visibilityBtn.innerText = 'Show Always';
            arrowsPlugin.setVisibility('ALWAYS');
          }
        })
      }
    </script>
  </body>
</html>